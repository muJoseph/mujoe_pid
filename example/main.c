#include "mujoe_pid.h"

//////////////////////////////////////////////////////////////////////////////////////////////
//  LOCAL VAR
//////////////////////////////////////////////////////////////////////////////////////////////

// PID Context structure
static mujoe_pid_t mujoe_pid;

//////////////////////////////////////////////////////////////////////////////////////////////
//  LOCAL FUNC
//////////////////////////////////////////////////////////////////////////////////////////////

static float dummy_plant( float control );

//////////////////////////////////////////////////////////////////////////////////////////////
//  MAIN
//////////////////////////////////////////////////////////////////////////////////////////////

int main(void)
{

	// Initialize PID context configuration structure with demo parameters:
	// Kp = 1
	// Ki = 2
	// Kd = 0.0125
	// Sample time: 100 ms
	// LPF 3dB frequency: 20 Hz
	// Output saturation: disabled
	// Anti-windup: disabled
	mujoe_pid_cfg_t pid_cfg;
    mujoe_pid_initConfigParams( MUJOE_PID_CFG_PRESET_ID_DEMO, &pid_cfg );
	
	// Initialize PID context
    mujoe_pid_initCtx( &mujoe_pid, &pid_cfg);
	
	float dummy_setpoint = 1;
	float dummy_plant_output = 0;
	float dummy_err = 0;
	float control = 0;
	
	// Terminal loop
	for(;;)
	{
		// Compute closed loop error
		dummy_err = dummy_setpoint - plant_output;
		
		// Run PID, call every T seconds (100 ms)
		control = mujoe_pid_run( &mujoe_pid, dummy_err );
		
		// Drive plant
		plant_output = dummy_plant( control );
	}
	
    /*  */
    return 0;
}

//////////////////////////////////////////////////////////////////////////////////////////////
//  STATIC FUNC
//////////////////////////////////////////////////////////////////////////////////////////////

static float dummy_plant( float control )
{
	return control;
}